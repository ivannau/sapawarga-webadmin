# build stage
FROM node:12.16-alpine as build


ARG VUE_APP_BASE_API 
ARG SENTRY_DSN_API 
ARG GOOGLE_MAPS_WEB_API_KEY 
ARG VUE_APP_PHONE 
ARG VUE_APP_ANALYTICS_ID 
ARG VUE_APP_S3_URL 
ARG FIREBASE_API_KEY 
ARG FIREBASE_AUTH_DOMAIN 
ARG FIREBASE_STORAGE_BUCKET 
ARG FIREBASE_DB_URL 
ARG FIREBASE_PROJECT_ID 
ARG FIREBASE_MESSAGING_SENDER_ID 
ARG FIREBASE_APP_ID
ARG FIREBASE_MEASUREMENT_ID

ENV VUE_APP_BASE_API ${VUE_APP_BASE_API}
ENV SENTRY_DSN_API ${SENTRY_DSN_API}
ENV GOOGLE_MAPS_WEB_API_KEY ${GOOGLE_MAPS_WEB_API_KEY}
ENV VUE_APP_PHONE ${VUE_APP_PHONE}
ENV VUE_APP_ANALYTICS_ID ${VUE_APP_ANALYTICS_ID}
ENV VUE_APP_S3_URL ${VUE_APP_S3_URL}
ENV FIREBASE_API_KEY ${FIREBASE_API_KEY}
ENV FIREBASE_AUTH_DOMAIN ${FIREBASE_AUTH_DOMAIN}
ENV FIREBASE_STORAGE_BUCKET ${FIREBASE_STORAGE_BUCKET}
ENV FIREBASE_DB_URL ${FIREBASE_DB_URL}
ENV FIREBASE_PROJECT_ID ${FIREBASE_PROJECT_ID}
ENV FIREBASE_MESSAGING_SENDER_ID ${FIREBASE_MESSAGING_SENDER_ID}
ENV FIREBASE_APP_ID ${FIREBASE_APP_ID}
ENV FIREBASE_MEASUREMENT_ID ${FIREBASE_MEASUREMENT_ID}

RUN mkdir /app
COPY . /app
WORKDIR /app/backend

RUN apk update && apk upgrade && \
	apk add --no-cache git

RUN yarn install
RUN yarn global add @vue/cli && yarn build

# production stage
FROM nginx:1.21.0
COPY --from=build /app/backend/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]